!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react"),require("event-emitter"),require("isomorphic-unfetch"),require("ms"),require("async-sema")):"function"==typeof define&&define.amd?define(["react","event-emitter","isomorphic-unfetch","ms","async-sema"],n):(e=e||self).useMagicLink=n(e.react,e.EventEmitter,e.unfetch,e.ms,e.asyncSema)}(this,function(e,n,t,r,o){n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var u=function(e){try{return s?Promise.resolve(s):e&&c?(s=new c(e),Promise.resolve(s)):(l||(console.log("Loading Magic"),(l=window.document.createElement("script")).async=!0,l.src="https://cdn.jsdelivr.net/npm/magic-sdk/dist/magic.js",l.id="magic-link-sdk",l.onload=function(){c=window.Magic,i.emit("loaded")},document.head.appendChild(l)),e?Promise.resolve(new Promise(function(n){i.once("loaded",function(){s||(s=new c(e)),n(s)})})):Promise.resolve())}catch(e){return Promise.reject(e)}},i=new n,c=null,l=null,s=null;function a(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}function f(e,n){try{var t=e()}catch(e){return n(!0,e)}return t&&t.then?t.then(n.bind(null,!1),n.bind(null,!0)):n(!1,t)}var d=function(e){try{return Promise.resolve(h.acquire()).then(function(){return f(function(){return p&&p.expiredAt>Date.now()?p.token:Promise.resolve(u(e)).then(function(e){return Promise.resolve(e.user.getIdToken()).then(function(e){return P(e),e})})},function(e,n){if(h.release(),e)throw n;return n})})}catch(e){return Promise.reject(e)}},h=new o.Sema(1),m=new o.Sema(1),g=new n,v=null,p=null;function P(e,n){void 0===n&&(n=r("15min")),p={token:e,expiredAt:Date.now()+n-r("1min")}}return"undefined"!=typeof window&&u(),function(n){if(!n)throw new Error("Magic Link publishableKey required as the first argument");var r=e.useState(null!==v&&v),o=r[0],i=r[1],c=e.useState(null===v),l=c[0],s=c[1],h=e.useState(null),w=h[0],y=h[1],j=e.useState(!1),k=j[0],b=j[1],q=e.useState(!1),S=q[0],I=q[1];return e.useEffect(function(){function e(e){i(e)}return v||function(e){try{return Promise.resolve(m.acquire()).then(function(){var n,t=f(function(){return a(function(){return null!==v?(n=1,v):Promise.resolve(d(e)).then(function(){v=!0})},function(){v=!1})},function(e,n){if(m.release(),e)throw n;return n});return t&&t.then?t.then(function(e){return n?e:v}):n?t:v})}catch(e){return Promise.reject(e)}}(n).then(function(e){i(e)}).then(function(){return s(!1)}),g.on("loggedIn",e),function(){g.off("loggedIn",e)}},[v]),{loggedIn:o,loading:l,error:w,loggingIn:k,loggingOut:S,login:function(e){try{y(null),b(!0);var t=f(function(){return a(function(){return Promise.resolve(u(n)).then(function(n){var t=n.auth.loginWithMagicLink({email:e});v=!0,P(t),g.emit("loggedIn",!0),i(!0)})},function(e){y(e)})},function(e,n){if(b(!1),e)throw n;return n});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},logout:function(){try{y(null),I(!0);var e=f(function(){return a(function(){return Promise.resolve(u(n)).then(function(e){return Promise.resolve(e.user.logout()).then(function(){v=null,p=null,g.emit("loggedIn",!1),i(!1)})})},function(e){y(e)})},function(e,n){if(I(!1),e)throw n;return n});return Promise.resolve(e&&e.then?e.then(function(){return null===v}):null===v)}catch(e){return Promise.reject(e)}},fetch:function(e,r){void 0===r&&(r={});try{return Promise.resolve(d(n)).then(function(n){return n&&(r.headers=r.headers||{},r.headers.Authorization="Bearer "+n),t(e,r)})}catch(e){return Promise.reject(e)}},loginEvents:g}}});
//# sourceMappingURL=use-magic-link.umd.js.map
