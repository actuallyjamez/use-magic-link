!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react"),require("event-emitter"),require("isomorphic-unfetch"),require("async-sema")):"function"==typeof define&&define.amd?define(["react","event-emitter","isomorphic-unfetch","async-sema"],n):(e=e||self).useMagicLink=n(e.react,e.EventEmitter,e.unfetch,e.asyncSema)}(this,function(e,n,t,r){n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var o=function(e){try{return l?Promise.resolve(l):e&&i?(l=new i(e),Promise.resolve(l)):(c||((c=window.document.createElement("script")).async=!0,c.src="https://cdn.jsdelivr.net/npm/magic-sdk/dist/magic.js",c.id="magic-link-sdk",c.onload=function(){i=window.Magic,u.emit("loaded")},document.head.appendChild(c)),e?Promise.resolve(new Promise(function(n){u.once("loaded",function(){l||(l=new i(e)),n(l)})})):Promise.resolve())}catch(e){return Promise.reject(e)}},u=new n,i=null,c=null,l=null;function s(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}function f(e,n){try{var t=e()}catch(e){return n(!0,e)}return t&&t.then?t.then(n.bind(null,!1),n.bind(null,!0)):n(!1,t)}var a=function(e){try{return Promise.resolve(h.acquire()).then(function(){return f(function(){return g&&g.expiredAt>Date.now()?g.token:Promise.resolve(o(e)).then(function(e){return P=e,Promise.resolve(P.user.getIdToken()).then(function(e){return w(e),e})})},function(e,n){if(h.release(),e)throw n;return n})})}catch(e){return Promise.reject(e)}},h=new r.Sema(1),d=new r.Sema(1),m=new n,v=null,g=null,P=null;function w(e,n){void 0===n&&(n=9e5),g={token:e,expiredAt:Date.now()+n-6e4}}return"undefined"!=typeof window&&o(),function(n){if(!n)throw new Error("Magic Link publishableKey required as the first argument");var r=e.useState(null!==v&&v),u=r[0],i=r[1],c=e.useState(null===v),l=c[0],h=c[1],p=e.useState(null),y=p[0],j=p[1],k=e.useState(!1),S=k[0],b=k[1],q=e.useState(!1),I=q[0],E=q[1];return e.useEffect(function(){function e(e){i(e)}return v||function(e){try{return Promise.resolve(d.acquire()).then(function(){var n,t=f(function(){return s(function(){return null!==v?(n=1,v):Promise.resolve(a(e)).then(function(){v=!0})},function(){v=!1})},function(e,n){if(d.release(),e)throw n;return n});return t&&t.then?t.then(function(e){return n?e:v}):n?t:v})}catch(e){return Promise.reject(e)}}(n).then(function(e){i(e)}).then(function(){return h(!1)}),m.on("loggedIn",e),function(){m.off("loggedIn",e)}},[v]),{loggedIn:u,loading:l,error:y,loggingIn:S,loggingOut:I,login:function(e){try{j(null),b(!0);var t=f(function(){return s(function(){return Promise.resolve(o(n)).then(function(n){return Promise.resolve(n.auth.loginWithMagicLink({email:e})).then(function(e){v=!0,w(e),m.emit("loggedIn",!0),i(!0)})})},function(e){j(e)})},function(e,n){if(b(!1),e)throw n;return n});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},logout:function(){try{j(null),E(!0);var e=f(function(){return s(function(){return Promise.resolve(o(n)).then(function(e){return Promise.resolve(e.user.logout()).then(function(){v=null,g=null,m.emit("loggedIn",!1),i(!1)})})},function(e){j(e)})},function(e,n){if(E(!1),e)throw n;return n});return Promise.resolve(e&&e.then?e.then(function(){return null===v}):null===v)}catch(e){return Promise.reject(e)}},fetch:function(e,r){void 0===r&&(r={});try{return Promise.resolve(a(n)).then(function(n){return n&&(r.headers=r.headers||{},r.headers.Authorization="Bearer "+n),t(e,r)})}catch(e){return Promise.reject(e)}},loginEvents:m,magic:P}}});
//# sourceMappingURL=use-magic-link.umd.js.map
